{% extends 'base.html' %}

{% block content %}
<br>
<br>
<div class="grid grid-cols-5 grid-rows-[75vh,1fr,auto] bg-cream h-[90vh]">

    <!-- Chat history area -->
    <div class="col-span-3 row-span-1 overflow-y-auto p-4">
        <div class="h-full">
            {% for entry in conversation %}
                {% if entry.type == 'user' %}
                    <!-- User message -->
                    <div class="text-right p-2">
                        <span class="inline-block bg-blue-200 rounded px-3 py-1 text-sm font-semibold text-gray-700 mr-2 mb-2">{{ entry.text }}</span>
                    </div>
                {% else %}
                    <!-- Bot message -->
                    <div class="text-left p-2">
                        <span class="inline-block bg-green-200 rounded px-3 py-1 text-sm font-semibold text-gray-700 mr-2 mb-2">{{ entry.text }}</span>
                    </div>
                {% endif %}
            {% endfor %}
        </div>
    </div>

    <!-- Title and Description -->
    <div class="bg-gray-200 rounded-tr-lg col-span-2 row-span-1 p-4 overflow-y-auto">
        {% if sample_db %}
            <h1 class="text-xl font-bold text-gray-700">{{ sample_db.name }}</h1>
            <div class="text-gray-700">{{ description_html|safe }}</div>
        {% endif %}
    </div>

    <!-- Input and toggle button area -->
    <div class="col-span-5 row-span-1 h-[10vh] rounded-b-lg flex items-center justify-between p-4 bg-white border-t border-gray-200">
        <!-- Chat input area -->
        <form action="/chat" method="post" class="flex-grow flex mr-4">
            <input id="message" name="message" type="text" class="text-gray-700 flex-grow p-2 border border-gray-300 rounded" placeholder="Type your message">
            <input type="hidden" name="allow_db_edit_hidden" id="allow_db_edit_hidden" value="false">
            <button type="submit" class="ml-2 px-4 py-2 bg-blue-500 text-white rounded">
                Send
            </button>
        </form>
        <!-- Toggle switch -->
        <label for="allow_db_edit" class="flex items-center cursor-pointer">
            <div class="relative">
                <input type="checkbox" id="allow_db_edit" name="allow_db_edit" class="sr-only" onchange="toggleSwitch()">
                <div class="toggle-bg bg-gray-200 border-2 border-gray-200 h-6 w-11 rounded-full"></div>
                <div class="dot absolute left-1 top-1 bg-white w-4 h-4 rounded-full transition transform"></div>
            </div>
            <span class="ml-3 text-sm text-gray-700 font-medium">Allow Database Editing</span>
        </label>
    </div>


</div>

<script>
    // JavaScript to keep chat scrolled to bottom
    var chatWindow = document.querySelector('.overflow-y-auto');
    chatWindow.scrollTop = chatWindow.scrollHeight;

    // JavaScript for toggle switch
    function toggleSwitch() {
        var checkbox = document.getElementById('allow_db_edit');
        var hiddenInput = document.getElementById('allow_db_edit_hidden');
        var dot = document.querySelector('.dot');

        if (checkbox.checked) {
            dot.style.transform = 'translateX(100%)';
            dot.style.backgroundColor = '#4CAF50';
            hiddenInput.value = "true";
        } else {
            dot.style.transform = 'translateX(0%)';
            dot.style.backgroundColor = '#FFF';
            hiddenInput.value = "false";
        }
    }
</script>

{% endblock %}